<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="../style.css">
    <title>Porting a map</title>
    <link rel="icon" type="image/x-icon" href="../devtfvr_small.png">
    <meta content="Porting a map" property="og:title" />
    <meta content="a guide on how to port a map from tf2 to TFVR" property="og:description" />
    <meta content="https://realbucketofchicken.github.io/tfvrguides/index.html" property="og:url" />
    <meta content="https://realbucketofchicken.github.io/tfvrguides/devtfvr_small.png" property="og:image" />
    <meta content="#bd3a97" data-react-helmet="true" name="theme-color" />
</head>
<body>
    <a href="../index.html">
            <img src="../devtfvr_small.png" class="home" alt="return to home">
        </a>
    <div class="brickstop">
        <div class="middle" style="margin-top: 0;">
            <h1>Porting a map:</h1>
            <div class="note">
                <strong>NOTE:</strong>
                <p>this guide might not be intuitive in some parts yet!</p>
                ask for help on discord, you can ping me(bucket of chicken) or iconicplushstars
            </div>
            <h2>1. Prerequisites</h2>
            <p>Install team fortress 2 on steam if you don't already have it(its free!)</p>
            <p>Install <a href="https://download.blender.org/release/Blender3.6/blender-3.6.23-windows-x64.msi">blender 3.6</a></p>
            <p>Install the <a href="https://github.com/REDxEYE/SourceIO/releases">source.io blender plugin</a> (if you are a TFVR dev, use manoâ€™s custom source.io if you would want TFVR map materials)</p>
            <p>Install <a href="https://github.com/lasa01/Plumber/releases"> plumber blender plugin</a></p>
            <p>Install the <a href="../installingmodkit/modkit.html">contractors Modkit</a> (Basic unreal 4 knowledge is also needed)</p>
            <p>Install the <a href="https://github.com/botero-dev/blender-datasmith-export/releases">datasmith export plugin for blender</a></p>
            <p>Enable datasmith import in unreal</p>
            <h2>1.5 getting a map bsp</h2>

            <p>go to the folder where you installed tf2, and browse to <code>tf/maps</code>, here you will find every map in tf2!</p>
            
            <h2>Part one: Blender</h2>
            <p>First you want to open blender</p>
            <p>now, go to <code>file>import>source engine assets>source map .bsp</code></p>
            <img src="images/blenderimportsourcemap.png">
            <p>Now set the world scale to 0.023 and set light power scale to 0.0225 and check rope entities on</p>
            <img src="images/importoptions.png" style="max-height: 18cm; width: auto;">
            <p>Now find your map's bsp</p>
            <img src="images/importmap.png">
            <p>Once its done importing delete the collections logic and environment and then go to the "brushes" collection on the right and delete all the objects in respawn visualizer</p>
            <img src="images/deletebrushes.png">
            <p>Now set the sky camera scale to 16</p>
            <img src="images/skycam.png">
            <p>Select all the objects in static props and hit load entities, make sure to disable bvlg</p>
            <img src="images/LoadEntity.png" style="max-height: 20cm; width: auto;">
            <p>you <i>should</i> now have all models</p>
            <p>we dont have source-style skybox rendering so we need to remove the skybox</p>
            <p>first thing to do is just click on these walls,</p>
            <img src="images/selectsimilar1.png">
            <p>go into edit mode, </p>
            <img src="images/selectsimilar2.png">
            <p>and click on them again, so we select a single face, then you press shift + g and select material</p>
            <p>as the walls have a special material, only they will be selected</p>
            <img src="images/selectsimilar3.png">
            <p>now you can just press right click and go to seperate->selection</p>
            <img src="images/selectsimilar4.png">
            <p>Now you can delete them</p>
            <img src="images/selectsimilar5.png">
            <p>we're not using seperate by material because it will seperate <i>all</i> materials</p>
            <p>Now you need to select all displacement meshes(they are in a collection) and right click and go on shade smooth</p>
            <img src="images/shadesmooth.png">

            <p>now you need to split your meshes, to do this you need to execute the split mesh into chunks script</p>
            <a href="scripts/split_mesh_into_chunks.py" download>download split chunks script</a> <br>
            <img src="images/scriptingtut.png"><br>
            <p>Select your world geometry and execute the script</p>
            <!--<a href="scripts/merge_meshes_into_chunks.py" download>download merge meshes script(currently undocumented)</a>-->
            <p>Next you need to select all of your newly created chunks and go to <code>object->set origin->origin to geometry</code></p>
            <img src="images/origin.png">
            <p>unselect your chunks and now, manually merge your displacements into bigger chunks</p>
            <p>Select the skybox and go into wireframe rendering. now, while holding shift, you need to select the skybox camera object and then go to object->transform VMF 3D sky</p>
            <img src="images/transformsky.png">
            <p>Run the fixmodelnames script (and if you have mano's custom source io, also run his clearmaterials.py)</p>
            <p>once that is done select all objects in <strong>ONE</strong> collection and export them as udatasmith with <strong>selected objects only</strong> enabled, repeat this for all collections</p>
            <img src="images/ExportDatasmith.png">
            <p>Congrats, you are done with blender(<i>in this guide</i>)! only 1% survive this far!(i think)</p>
            
            <h2>Part two: She unreal on my engine</h2>
            <p>If you havent already, make a new map mod in unreal engine</p>
            <p>then open your map and click the datasmith icon</p>
            <img src="images/datasmithicon.png">
            <p>now one by one import each udatasmith file</p>
            <img src="images/datasmithfiles.png">
            <p>select your mod and import</p>
            <img src="images/Datasmithimport.png" style="max-height: 20cm; width: auto;">
            <p>Now fix any black materials if you didnt use mano's SourceIO</p>

            <p>Now you have your map imported in unreal, there are however several things you can & need to do.</p>
            <p>find more guides on the homepage</p>
            <a href="https://docs.google.com/document/d/1erP_TtVvz7SknzIwAloByNWpJUQqwdYklYgV86sYkeU">Or take a look at the old mapping guide</a>
            
        </div>
        <div class="footer">
            
        </div>
    </div>
</body>
